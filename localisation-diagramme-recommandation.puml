@startuml Recommandation Localisation pour Diagramme

title Recommandation - Gestion de la Localisation

class User {
  +_id: ObjectId
  +name: String
  +email: String
  +role: String
  +phone: String
  +isAvailable: Boolean
  +address: String
  +currentLocation: GeoJSONPoint
}

class Order {
  +_id: ObjectId
  +user: ObjectId -> User
  +items: Array[OrderItem]
  +totalAmount: Number
  +status: String
  +deliveryAddress: String
  +customerLocation: CustomerLocation
  +deliveryMan: ObjectId -> User
  +deliveryRating: Number
  +payment: ObjectId -> Payment
}

class DeliveryHistory {
  +_id: ObjectId
  +deliveryManId: ObjectId -> User
  +orderId: ObjectId -> Order
  +customerId: ObjectId -> User
  +pickupLocation: DeliveryLocation
  +deliveryLocation: DeliveryLocation
  +routePoints: Array[RoutePoint]
  +totalDistance: Number
  +totalTime: Number
  +averageSpeed: Number
  +statusHistory: Array[StatusEntry]
  +deliveryRating: Number
  +deliveredAt: Date
}

' Types de localisation
class GeoJSONPoint {
  +type: String (Point)
  +coordinates: Array[Number] (longitude, latitude)
}

class CustomerLocation {
  +latitude: Number
  +longitude: Number
  +accuracy: Number
  +timestamp: Date
}

class DeliveryLocation {
  +latitude: Number
  +longitude: Number
  +address: String
  +timestamp: Date
}

class RoutePoint {
  +latitude: Number
  +longitude: Number
  +timestamp: Date
  +accuracy: Number
  +speed: Number
  +heading: Number
}

class StatusEntry {
  +status: String
  +timestamp: Date
  +location: DeliveryLocation
  +notes: String
}

' Relations
User ||--|| GeoJSONPoint : "currentLocation"
Order ||--|| CustomerLocation : "customerLocation"
DeliveryHistory ||--|| DeliveryLocation : "pickupLocation"
DeliveryHistory ||--|| DeliveryLocation : "deliveryLocation"
DeliveryHistory ||--o{ RoutePoint : "routePoints"
DeliveryHistory ||--o{ StatusEntry : "statusHistory"
StatusEntry ||--|| DeliveryLocation : "location"

' Notes explicatives
note top of GeoJSONPoint : "**GeoJSON Format**\n\nUtilisé pour:\n• Localisation en temps réel\n• Requêtes géospatiales MongoDB\n• Index géospatial\n\nFormat: [longitude, latitude]"

note right of CustomerLocation : "**Localisation Client**\n\nUtilisée pour:\n• Adresse de livraison précise\n• Calcul de distance\n• Timestamp de la commande\n\nFormat: latitude, longitude"

note bottom of DeliveryLocation : "**Localisation Livraison**\n\nUtilisée pour:\n• Point de ramassage\n• Point de livraison\n• Historique des positions\n• Adresse textuelle"

note left of RoutePoint : "**Points de Route**\n\nUtilisés pour:\n• Tracking GPS en temps réel\n• Calcul de distance parcourue\n• Optimisation de route\n• Métriques de performance"

@enduml
