# ğŸ“¦ Base image
FROM node:22-alpine

# ğŸ“ Dossier de travail dans le conteneur
WORKDIR /app

# ğŸ“„ Copie des fichiers package.json et package-lock.json
COPY package*.json ./

# ğŸ“¥ Installation des dÃ©pendances avec cache optimisÃ©
RUN npm ci --only=production --cache .npm --legacy-peer-deps --prefer-offline


# ğŸ—‚ï¸ Copie de tout le code source
COPY . .

# ğŸ“‚ CrÃ©e le dossier uploads (pour les fichiers utilisateurs)
RUN mkdir -p uploads

# ğŸŒ± Variables d'environnement (tu peux aussi les passer via docker-compose ou CLI)
ENV NODE_ENV=production
ENV PORT=5000

# ğŸ”¥ Exposition du port 5000
EXPOSE 5000

# ğŸ Commande de dÃ©marrage
CMD ["npm", "start"] 